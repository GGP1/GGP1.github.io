[{"content":"\u003cp\u003eThis is the part 2 of a series covering \u003cstrong\u003esql\u003c/strong\u003e and \u003cstrong\u003eGo\u003c/strong\u003e, this time, we will cover how to work with SQL transactions context and isolation levels, results dynamic scanning, full text search and recursive queries as well as using multiple result sets to do many queries in a single roundtrip.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eTo go to part one, click \u003ca href=\"../mastering_sql_with_go_p1\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"transactions\"\u003eTransactions\u003c/h2\u003e\n\u003cp\u003eLet\u0026rsquo;s start with transactions, why are they necessary?\u003c/p\u003e\n\u003cp\u003eA transaction is a way for an application to group several reads and writes together into a logical unit.\u003c/p\u003e\n\u003cp\u003eConceptually, all the reads and writes in a transaction are executed as one operation: either the entire transaction succeeds (\u003cem\u003ecommit\u003c/em\u003e) or it fails (\u003cem\u003eabort\u003c/em\u003e/\u003cem\u003erollback\u003c/em\u003e).\u003c/p\u003e\n\u003cp\u003eThey are an abstraction layer that allows an application to pretend that certain concurrency problems and certain kinds of hardware and software faults don\u0026rsquo;t exist.\u003c/p\u003e\n\u003cp\u003eLet\u0026rsquo;s see how can we take advantage of them.\u003c/p\u003e\n\u003ch3 id=\"propagation-using-context\"\u003ePropagation using context\u003c/h3\u003e\n\u003cp\u003eSpecially in large projects, a single request can perform several calls to one or perhaps many services.\u003c/p\u003e\n\u003cp\u003eIf we were to execute and commit this operations separately, any error that occurs between them leaves the database in a corrupted state.\u003c/p\u003e\n\u003cp\u003eIn order to avoid this, we need to \u0026ldquo;share\u0026rdquo; or execute the whole workflow in a single transaction, taking advantage of the \u003ca href=\"https://en.wikipedia.org/wiki/ACID\"\u003eACID\u003c/a\u003e  (atomicity, consistency, isolation, durability) properties they bring us.\u003c/p\u003e\n\u003cp\u003eThis way, we commit all the changes that were made in a single and atomic transaction, making sure that they either \u003cstrong\u003esucceed\u003c/strong\u003e or \u003cstrong\u003efail completely\u003c/strong\u003e. In some cases, if the transaction fails, we can simply retry.\u003c/p\u003e\n\u003cp\u003eNow, passing down transactions as parameters will mess the code up and it isn\u0026rsquo;t a scalable solution. We will store the transaction in the request\u0026rsquo;s context so it can be accessed on lower layers:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// --- sqltx.go ---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003epackage\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esqltx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;context\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;database/sql\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// txKey is the context key for the sql transaction.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etxKey\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ekey\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ekey\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estruct\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// NewContext returns a new context with a sql transaction in it.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eNewContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eTx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContext\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eBackground\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eWithValue\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etxKey\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// FromContext returns the sql transaction stored in the context.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e//\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// It panics if there is no transaction.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eFromContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eTx\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eok\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eValue\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003etxKey\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e).(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eTx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eok\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#6639ba\"\u003epanic\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;sql tx not found\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// --- service.go ---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eservice\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estruct\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003es\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eMutationA\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003esqlTx\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esqltx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eFromContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;INSERT INTO posts (id, title, content) VALUES (\u0026#39;1\u0026#39;, \u0026#39;Title\u0026#39;, \u0026#39;Post content\u0026#39;)\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003esqlTx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExecContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003es\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eMutationB\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003econtext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003esqlTx\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esqltx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eFromContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003esqlTx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExecContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;UPDATE users SET posts_count = posts_count + 1\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// --- handler.go ---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// db and service objects creation omitted to simplify the scenario\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eHandleRequest\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ehttp\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eResponseWriter\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003er\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ehttp\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eRequest\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eBeginTx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eRollback\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esqltx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eNewContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003er\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(),\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eMutationA\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// Rollback changes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eservice\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eMutationB\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// Rollback changes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Commit both mutations atomically, in case of a failure none will take effect\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eCommit\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis way, we can easily use the same transaction in different operations and even services. Given that it\u0026rsquo;s stored at the request-level, the action the user took will either succeed or fail, but it will always prevent leaving the system in a corrupted state.\u003c/p\u003e\n\u003cp\u003eBut this is not the only thing to take into account when working with SQL, there is also different kind of transactions that have different consistency and performance trade-offs, let\u0026rsquo;s review them.\u003c/p\u003e\n\u003ch3 id=\"isolation-levels\"\u003eIsolation levels\u003c/h3\u003e\n\u003cp\u003eMany databases support setting different isolation levels to transactions, an isolation level determines the degree to which that data is isolated from other concurrent processes.\u003c/p\u003e\n\u003cp\u003eA lower isolation level allows many users to access the same information at the same time, but increases the probabilities of encountering inconsistencies among the different results. A higher isolation level ensures less concurrency effects but requires most system resources and the chances that one transaction may block another.\u003c/p\u003e\n\u003cp\u003eSome of the ones supported by the Go standard library package are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRead uncommitted\u003c/strong\u003e: In this level a transaction may see uncommited changes made by other transactions, it\u0026rsquo;s the lowest isolation level.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePostgreSQL\u0026rsquo;s Read Uncommitted mode behaves like Read Committed.\u003c/p\u003e\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRead committed\u003c/strong\u003e: It\u0026rsquo;s the default level. A query sees only data committed before the query began; it never sees either uncommitted data or changes committed during query execution by concurrent transactions.\u003c/p\u003e\n\u003cp\u003eHowever, the query does see the effects of previous updates executed within its own transaction, even though they are not yet committed.\u003c/p\u003e\n\u003cp\u003eNote that two successive \u003ccode\u003eSELECT\u003c/code\u003e commands can see different data.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRepeatable read\u003c/strong\u003e: In this level, the transaction only sees data committed before it began.\u003c/p\u003e\n\u003cp\u003eThis level is different from Read Committed in that a query in a repeatable read transaction sees a snapshot as of the start of the first non-transaction-control statement in the transaction, not as of the start of the current statement within the transaction. Thus, successive SELECT commands within a single transaction see the same data.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eSerializable\u003c/strong\u003e: It is the strictest isolation level. In it, transactions are executed sequentially, that is, one after another and without any concurrency.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn Go, one could create a transaction with a specific isolation level by doing:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003etx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eBeginTx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eTxOptions\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eIsolation\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eLevelSerializable\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e})\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHaving discussed how to manage transactions and the different kind of them, let\u0026rsquo;s move over to the concept of dynamic scanning, parsing SQL transactions results without having to code one method per query.\u003c/p\u003e\n\u003ch2 id=\"dynamic-scanning\"\u003eDynamic scanning\u003c/h2\u003e\n\u003cp\u003eThe Go standard library provides a basic interface that does an acceptable job, but in some cases it falls behind requirements like:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUse always the same method for scanning any type of object\u003c/li\u003e\n\u003cli\u003eScan fields dynamically (let the user choose which fields to receive)\u003c/li\u003e\n\u003cli\u003eSimple and compact interface\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet\u0026rsquo;s take a look at how we would scan fields into an object with Go\u0026rsquo;s native methods\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estruct\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eTitle\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003egetPosts\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e([]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT title, content FROM posts WHERE id=$1\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eNext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// Here we would have to add all the fields we want to scan, \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// the bigger the struct and the query the messier it becomes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eScan\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eTitle\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eappend\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eClose\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis implementation is verbose, it would require us to create a method for every query (or at least those that are not equal) and the fields returned are hardcoded.\u003c/p\u003e\n\u003cp\u003eHopefully, we have many solutions for these problems, there are many production-ready packages that help manage sql queries in a simple and clean way.\u003c/p\u003e\n\u003cp\u003eIn this case, I\u0026rsquo;m going to introduce one that is simple, compatible with the standard library and that supports recursive mapping of object fields. It\u0026rsquo;s called \u003ca href=\"https://github.com/GGP1/sqan\"\u003esqan\u003c/a\u003e, and I will explain how it works in the next two sections: \u003cem\u003emapping\u003c/em\u003e and \u003cem\u003escanning\u003c/em\u003e.\u003c/p\u003e\n\u003ch3 id=\"mapping\"\u003eMapping\u003c/h3\u003e\n\u003cp\u003eSqan maps objects fields using a nested map where the top level key is the field type, the inner map then uses the field names or their \u003ccode\u003edb\u003c/code\u003e tag (if specified) as the key and the indices they represent inside the struct as the value.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eUnexported fields and struct slices are skipped\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eFor example, the following struct\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estruct\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eTitle\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e`db:\u0026#34;title\u0026#34;`\u003c/span\u003e \u003cspan style=\"color:#57606a\"\u003e// Optional, could be any string\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eComment\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eComment\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eComment\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estruct\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eLikes\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eis mapped like\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ePost:\n\ttitle: 0\n\tcontent: 1\n\tcontent: 2 0\n\tlikes: 2 1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe field\u0026rsquo;s type and indices are obtained using reflection, in case the field is an embedded struct, the mapping is done in the same way as the top one (using recursion).\u003c/p\u003e\n\u003cp\u003eThe mapping is executed the first time the struct is used to store sql results and the information remains in memory and ready to be used by the scanner.\u003c/p\u003e\n\u003ch3 id=\"scanning\"\u003eScanning\u003c/h3\u003e\n\u003cp\u003eWhen scanning results, Sqan looks for the columns names in the SQL query and creates a slice with the fields required and an empty value for each of them, which will then be populated by the SQL scanner with the values retrieved from the database.\u003c/p\u003e\n\u003cp\u003eIt uses the field\u0026rsquo;s indices stored in the map to know where to allocate the empty value and reflection to create it.\u003c/p\u003e\n\u003cp\u003eAnd that\u0026rsquo;s how we use every value from the map to generate dynamic slices to scan SQL results.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003egetPosts\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e([]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT title, content FROM posts WHERE id=$1\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esqan\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eRows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow our Go code is not only simpler, but we could also let the clients (validating and sanitizing their inputs) ask for fields on demand.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSqan also works when scanning a single value (\u003ccode\u003esqan.Row()\u003c/code\u003e)\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"full-text-search\"\u003eFull Text Search\u003c/h2\u003e\n\u003cp\u003eThere are cases in which a simple \u003ccode\u003eSELECT \u0026lt;fields\u0026gt;\u003c/code\u003e falls short to deliver what we are looking for. Full text search is one of those cases, if we want to get rows that contain but are not equals to a speficic value, we will have to use them. Let\u0026rsquo;s see how they work.\u003c/p\u003e\n\u003cp\u003eTo implement full text searching there must be a function to create a \u003ccode\u003etsvector\u003c/code\u003e from a document and a \u003ccode\u003etsquery\u003c/code\u003e from a user query.\u003c/p\u003e\n\u003cp\u003eThe function we are going to use is\u003ccode\u003eto_tsvector\u003c/code\u003e, which parses a textual document into tokens and reduces the tokens to lexemes. Here is an example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eto_tsvector\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;english\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;a fat  cat sat on a mat - it ate a fat rats\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e                  \u003c/span\u003eto_tsvector\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-----------------------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;ate\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e9\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;cat\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e3\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;fat\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e11\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;mat\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e7\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;rat\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e12\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;sat\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e4\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- The resulting tsvector does not contain the words a, on, or it, the word rats became rat, and the punctuation sign - was ignored\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can use the function \u003ccode\u003eto_tsvector()\u003c/code\u003e to create a vector on a table field. For example, here we will look for the text \u0026ldquo;Rice\u0026rdquo; in the field \u0026ldquo;title\u0026rdquo;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// If you want to match any string starting with the value below, add \u0026#34;:*\u0026#34; to it to match prefixes as well\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003etext\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;Rice\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT title, description FROM posts WHERE to_tsvector(title) @@ plainto_tsquery($1)\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eplainto_tsquery\u003c/code\u003e transforms the unformatted text querytext to a \u003ccode\u003etsquery\u003c/code\u003e value. The text is parsed and normalized much as for to_tsvector, then the \u0026amp; (AND) tsquery operator is inserted between surviving words.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eIt will return all the products that contain the word \u0026ldquo;Rice\u0026rdquo; on its title.\u003c/p\u003e\n\u003cp\u003eTo look for text on several fields, concatenate using \u003ccode\u003e|| ' ' ||\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;... to_tsvector(title || \u0026#39; \u0026#39; || description) ...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eThere\u0026rsquo;s no limit to the number of fields that can be included as vectors to look for text in them, the only constraint is performance.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eHowever, by querying information this way, we are creating the vectors on the fly and if we perform many queries of these type the SQL engine would have to generate the indices on each one of the operations, which is really inefficient.\u003c/p\u003e\n\u003cp\u003eTo solve this, we can instruct the database to create the index when the table is created and to update it each time a new row is inserted, effectively moving the calculations to the \u003cem\u003ewrite side\u003c/em\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eCREATE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eTABLE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eIF\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eNOT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eEXISTS\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003etitle\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eNOT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eNULL\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003edescription\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eNOT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eNULL\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003esearch\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003etsvector\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- The search field will represent an index of both title and description field contents\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- Create index of type GIN (more about GIN at https://www.postgresql.org/docs/15/gin-intro.html)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCREATE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eINDEX\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eON\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eUSING\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eGIN\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003esearch\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- Create the function that creates the index\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCREATE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eOR\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eREPLACE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFUNCTION\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts_tsvector_trigger\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRETURNS\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003etrigger\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eAS\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e$$\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eBEGIN\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- setweight takes a vector and a letter, and it\u0026#39;s typically used to mark different parts of a document\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- Later, they can be used for ranking search results\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003esearch\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003esetweight\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003eto_tsvector\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;english\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003etitle\u003cspan style=\"color:#1f2328\"\u003e),\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003esetweight\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003eto_tsvector\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;english\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003edescription\u003cspan style=\"color:#1f2328\"\u003e),\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#39;B\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e;\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eEND\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e$$\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eLANGUAGE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eplpgsql\u003cspan style=\"color:#1f2328\"\u003e;\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- Delete the trigger if it existed previously so the operation below does not fail\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eDROP\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eTRIGGER\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eIF\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eEXISTS\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts_tsvector_update\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eON\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts\u003cspan style=\"color:#1f2328\"\u003e;\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- Instruct the database to execute the trigger before each product addition\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCREATE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eTRIGGER\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts_tsvector_update\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eBEFORE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eINSERT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eOR\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eUPDATE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e    \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eON\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFOR\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eEACH\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eROW\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eEXECUTE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ePROCEDURE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eproducts_tsvector_trigger\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eIf the fields you are using can be null, you should use the \u003ccode\u003ecoalesce()\u003c/code\u003e function when creating the index to convert the content to an empty string, i.e \u003ccode\u003eto_tsvector(coalesce(title,''))\u003c/code\u003e. Otherwise \u003ccode\u003eto_tsvector(NULL)\u003c/code\u003e will return \u003ccode\u003eNULL\u003c/code\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eWe can now look for products containing the word \u0026ldquo;Apple\u0026rdquo;  in their \u003ccode\u003etitle\u003c/code\u003e and \u003ccode\u003edescription\u003c/code\u003e fields by using the already generated index on the \u003ccode\u003esearch\u003c/code\u003e field:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT title, description FROM posts WHERE search @@ plainto_tsquery(\u0026#39;Apple\u0026#39;)\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eMoreover, we can set the order of the query to prioritize the fields with more weight:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003etext\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;Apple\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e`SELECT title, description \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003eFROM posts \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003eWHERE search @@ plainto_tsquery($1)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003eORDER BY ts_rank(search, plainto_tsquery($1)) DESC`\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAs we set a higher priority to the \u003ccode\u003etitle\u003c/code\u003e field, the ones containing the \u003ccode\u003eApple\u003c/code\u003e text in it will be at the top of the list and above the products that have it in the \u003ccode\u003edescription\u003c/code\u003e field.\u003c/p\u003e\n\u003ch2 id=\"recursive-queries\"\u003eRecursive queries\u003c/h2\u003e\n\u003cp\u003eNow imagine we want to retrieve all the replies from a post and the replies to those comments as well, this scenario is proposed for \u003cstrong\u003eeducational purposes\u003c/strong\u003e, ideally you will need to load one comment at a time when a user requests it. The query would be as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eWITH\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRECURSIVE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003ereplies\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eAS\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\u003c/span\u003eid\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003euser_id\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003econtent\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003ecomments\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eparent_comment_id\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- Below we get the replies of the replies and we \u0026#34;append\u0026#34; them\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e-- to our current matches (the top level ones)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eUNION\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003eid\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003eparent_comment_id\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003euser_id\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003econtent\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003ecomments\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\t\t\t\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eINNER\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eJOIN\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003ereplies\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003er\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eON\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003er\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003eid\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003eparent_comment_id\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#fff\"\u003e\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eid\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003eparent_comment_id\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003euser_id\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003econtent\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#fff\"\u003e \u003c/span\u003ereplies\u003cspan style=\"color:#fff\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eIf a comment is a reply to the post and not to a comment then \u003ccode\u003eparent_comment_id\u003c/code\u003e will be null.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"multiple-result-sets\"\u003eMultiple result sets\u003c/h2\u003e\n\u003cp\u003eLastly, we will cover how to execute multiple \u003ccode\u003eSELECT\u003c/code\u003e queries in a single roundtrip with \u003cem\u003eresults sets\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eThis is really useful in cases where the database is the system\u0026rsquo;s bottleneck because it is receiving a lot of concurrent connections. Doing all the operations in a single call can hurt a program\u0026rsquo;s readability, but it can also reduce the network latency and optimize the overall workflow.\u003c/p\u003e\n\u003cp\u003eAs you can see below, the implementation is pretty straightforward and self-explanatory.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003egetPostsAndComments\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT * from posts; SELECT * from comments;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eFatal\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eClose\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Loop through the posts (first query)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eNext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// Scan posts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Advance to next result set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// It returns a boolean indicating if there are further sets\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003enextSet\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eNextResultSet\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enextSet\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eErr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Loop through the comments (second query)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eNext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// Scan comments\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Check for any error in either result set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erows\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eErr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"references\"\u003eReferences\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://dataintensive.net/\"\u003eDesigning Data-Intensive Applications by Martin Kleppmann\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.postgresql.org/docs/current/textsearch-controls.html\"\u003eControlling Text Search\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","description":"","image":"/images/sql_go_p2.png","permalink":"https://ggp1.github.io/posts/mastering_sql_with_go_p2/","title":"Mastering SQL with Go - Part 2"},{"content":"\u003cp\u003eI found myself using SQL a lot in one of my projects and I have learnt many things while trying to solve the problems I encountered.\u003c/p\u003e\n\u003cp\u003eThis post is the part one of a series where I will try to show how to manage data in a relational database using SQL (Postgre syntax), Go and its standard library package \u003ca href=\"https://github.com/golang/go/tree/master/src/database/sql\"\u003e\u003ccode\u003edatabase/sql\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eExplaining absolutely everything would require an entire book so I will skip the subjects that most articles already cover (connection establishment, foreign keys, parameterized arguments, etc).\u003c/p\u003e\n\u003ch2 id=\"connection-tuning\"\u003eConnection tuning\u003c/h2\u003e\n\u003cp\u003eWhen we connect to an SQL database through a driver and using the \u003ccode\u003edatabase/sql\u003c/code\u003e package we get the \u003ca href=\"https://pkg.go.dev/database/sql#DB\"\u003e\u003ccode\u003esql.DB\u003c/code\u003e\u003c/a\u003e database handle, which manages a pool of active connections that are safe for concurrent use, creating new ones when required.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eTo perform actions on a dedicated connection, we can use \u003ca href=\"https://pkg.go.dev/database/sql#Conn\"\u003e\u003ccode\u003esql.Conn\u003c/code\u003e\u003c/a\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThe management of these connections can be personalized by using the following methods:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Set the maximum number of concurrent open connections.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// There is no limit defined by default.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// After the limit is passed, new datatabase operations will block \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// until there\u0026#39;s an available connection.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eSetMaxOpenConns\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003en\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eint\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Set a connection\u0026#39;s maximum life time.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Default is 2.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Increasing this value will improve the database performance at the\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// cost of consuming more memory to keep the connections alive.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eSetMaxIdleConns\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003en\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eint\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Set a connection\u0026#39;s maximum life time, once the time is reached it \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// cannot be used again.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// By default connections are reused forever.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Every one second the `database/sql` package removes expired connections \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// from the pool.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eSetConnMaxLifetime\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ed\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etime\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eDuration\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Set a connection\u0026#39;s maximum idle time.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// No value is set by default, connections may be idle their entire lifetime.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eSetConnMaxIdleTime\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ed\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etime\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eDuration\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe recommended values for these configurations depend on the type of application the database is used for, it may be convenient to specify and tweak them on the fly based on metrics gathered.\u003c/p\u003e\n\u003cp\u003eI personally prefer to begin limiting the maximum number and time of \u003cstrong\u003eidle\u003c/strong\u003e connections to avoid holding them for a long period of time (i.e. a burst of requests may open many connections that later won\u0026rsquo;t be used anymore).\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eA simple and useful way of getting more information about the database connection is the \u003ca href=\"https://pkg.go.dev/database/sql#DB.Stats\"\u003e\u003ccode\u003edb.Stats()\u003c/code\u003e\u003c/a\u003e method.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"scanning-null-values\"\u003eScanning null values\u003c/h2\u003e\n\u003cp\u003eIf we attempt to scan a null value into a non-pointer variable we will receive an error saying that a null value can\u0026rsquo;t be scanned into a Go type. There are (at least) three ways to address this problem:\u003c/p\u003e\n\u003ch3 id=\"coalesce\"\u003eCOALESCE\u003c/h3\u003e\n\u003cp\u003eThe \u003cem\u003eCOALESCE\u003c/em\u003e function takes \u003cem\u003en\u003c/em\u003e arguments and returns the first one that is not null, hence, we can use the targeted field as the first argument and then a default value to be returned when the first one is null.\u003c/p\u003e\n\u003cp\u003eThe query would be as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT COALESCE(description, \u0026#39;\u0026#39;) as description FROM posts WHERE id=\u0026#39;sample\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"standard-library-types\"\u003eStandard library types\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003edatabase/sql\u003c/code\u003e package has various types for scanning potentially null values (\u003ccode\u003esql.NullString\u003c/code\u003e, \u003ccode\u003esql.NullInt\u003c/code\u003e, \u003ccode\u003esql.NullBool\u003c/code\u003e, etc.)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// SELECT description FROM posts WHERE id=\u0026#39;sample\u0026#39;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003escanString\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003erow\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eRow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eNullString\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eScan\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// We can check if the value is null by using the nullable.Valid field.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eValid\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// nullable is null\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eString\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"pointers\"\u003ePointers\u003c/h3\u003e\n\u003cp\u003eThe last option, and probably the most used one, is to declare a pointer that will be equal to \u003ccode\u003enil\u003c/code\u003e in case there is no value stored.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// SELECT description FROM posts WHERE id=\u0026#39;sample\u0026#39;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003escanString\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003erow\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eRow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eScan\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003enullable\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"storing-slices\"\u003eStoring slices\u003c/h2\u003e\n\u003cp\u003eStoring a list of items that correspond to an object is generally done by using a new table and a foreign key to link both records.\u003c/p\u003e\n\u003cp\u003eHowever, in the case of simple data types like text and integer we can use \u003ccode\u003etext[]\u003c/code\u003e and \u003ccode\u003einteger[]\u003c/code\u003e respectively.\u003c/p\u003e\n\u003cp\u003eThis isn\u0026rsquo;t only simpler but it doesn\u0026rsquo;t require to create a new table and one new row per slice element.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFor further information, see the \u003ca href=\"https://www.postgresql.org/docs/14/arrays.html\"\u003eofficial docs\u003c/a\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eLet\u0026rsquo;s take a look at how to store a string slice in PostgreSQL with Go:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Package \u0026#34;github.com/lib/pq\u0026#34; required\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e//\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// `keys` field is of type text[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003einsertKeys\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eDB\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ekeys\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eStringArray\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;INSERT INTO users (keys) VALUES ($2) WHERE id=$1\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ekeys\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// pq.StringArray underlying type is []string\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003egetKeys\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eDB\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e([]\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003erow\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQueryRow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT keys FROM users WHERE id=$1\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ekeys\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eStringArray\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003erow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eScan\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ekeys\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ekeys\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"update-only-what-changes\"\u003eUpdate only what changes\u003c/h2\u003e\n\u003cp\u003eThe \u003ca href=\"#coalesce\"\u003eCOALESCE\u003c/a\u003e function we\u0026rsquo;ve seen above is also handy for updating only the fields that the user specified a value for.\u003c/p\u003e\n\u003cp\u003eConsider a scenario where we want the users to update a post\u0026rsquo;s content, the image or both.\u003c/p\u003e\n\u003cp\u003eWe will use string pointers for our struct fields to distinguish null values, otherwise we wouldn\u0026rsquo;t know whether the user wants to store and empty string or to not change anything.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eUpdatePost\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estruct\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eImage\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003eupdatePost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eDB\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eUpdatePost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e`UPDATE posts SET \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\tcontent = COALESCE($2, content)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\timage = COALESCE($3, image)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\tWHERE id = $1`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExec\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eImage\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis way, if the user updated the content only, COALESCE will detect that the image argument is null and thus use the already stored value, leaving the field as it was prior to the update.\u003c/p\u003e\n\u003ch2 id=\"batch-inserts\"\u003eBatch inserts\u003c/h2\u003e\n\u003cp\u003eInserting multiple records at once is typically an expensive operation and that\u0026rsquo;s why we need an optimal solution for it.\u003c/p\u003e\n\u003ch3 id=\"bulk-imports\"\u003eBulk imports\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eCOPY\u003c/code\u003e command is optimized for loading large numbers of rows; it is less flexible than \u003ccode\u003eINSERT\u003c/code\u003e, but incurs significantly less overhead for large data loads.\u003c/p\u003e\n\u003cp\u003eSince it\u0026rsquo;s a single command, there is no need to disable autocommit if you use this method to populate a table. Also, it stops operation at the first error.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCOPY FROM\u003c/code\u003e will invoke any triggers and check constraints on the destination table. However, it will not invoke rules.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003ebulkImports\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003esql\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eDB\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ePost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eerror\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003ePrepare\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;COPY posts (id, title, content) FROM STDIN\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eClose\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eposts\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExecContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eID\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eTitle\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epost\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eContent\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Flush buffered data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExecContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"query-building\"\u003eQuery building\u003c/h3\u003e\n\u003cp\u003eAnother way to insert multiple records in one call is to build a query containing a set of arguments for each of them.\u003c/p\u003e\n\u003cp\u003eFor example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;INSERT INTO posts (id, title, content, image) VALUES ($1, $2, $3), ($4, $5, $6)\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eTake a look at the implementation \u003ca href=\"https://stackoverflow.com/questions/12486436/how-do-i-batch-sql-statements-with-package-database-sql\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eNote that the maximum number of arguments supported by \u003ccode\u003eVALUES\u003c/code\u003e is 1000.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"pagination\"\u003ePagination\u003c/h2\u003e\n\u003cp\u003ePagination is the process of dividing a document into discrete pages.\u003c/p\u003e\n\u003cp\u003eIn programming, we provide our clients the possibility to paginate the list of results by using a cursor.\u003c/p\u003e\n\u003cp\u003eA cursor could be thought as a flag that divides already seen records and not yet seen ones.\u003c/p\u003e\n\u003cp\u003eOn each request, we return a new cursor (which may be an id or an encoded string) so the user can ask for more records without getting repeated ones.\u003c/p\u003e\n\u003cp\u003eHere are two common ways of implementing pagination in SQL that are safe from injection:\u003c/p\u003e\n\u003ch3 id=\"using-uuids\"\u003eUsing UUIDs\u003c/h3\u003e\n\u003cp\u003eWe select the posts that were created before the date passed, in case the date matches with the creation timestamp, the ID is compared.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIn this case, the cursor is generally an encoded string that contains both the ID and the creation timestamp.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Requires the table to have a field with a timestamp of the value creation\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;3c0217ac-503f-45dc-b150-0b1618155d3d\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003ecreatedAt\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003etime\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eNow\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e`SELECT * FROM posts WHERE \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003ecreated_at \u0026lt; $1 OR (created_at = $1 AND id \u0026lt; $2) \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003eORDER BY created_at DESC, id DESC LIMIT 5`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ecreatedAt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"using-lexicographically-sortable-ids\"\u003eUsing lexicographically sortable IDs\u003c/h3\u003e\n\u003cp\u003eSince the IDs are already sorted there is no need to compare the creation date, the ID is the cursor itself.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;01FMA344NAGPSKF4TNAXMC06KS\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQuery\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT * FROM posts WHERE id \u0026lt; $1 ORDER BY id DESC LIMIT 5\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"prepared-statements\"\u003ePrepared statements\u003c/h2\u003e\n\u003cp\u003eWhen we make a query using \u003ca href=\"https://pkg.go.dev/database/sql#DB.Query\"\u003e\u003ccode\u003edb.Query()\u003c/code\u003e\u003c/a\u003e, a prepared statement is built underneath to run it, but it\u0026rsquo;s used only once.\u003c/p\u003e\n\u003cp\u003eIf we were to execute the same query multiple times, we would be wasting resources as the prepared statement would be compiled on each iteration.\u003c/p\u003e\n\u003cp\u003eIn order to fix this, we can use \u003cem\u003eprepared statements\u003c/em\u003e, they allow us to compile the query with parameterized arguments separetely and then use that statement \u003cem\u003en\u003c/em\u003e times.\u003c/p\u003e\n\u003cp\u003eAnother advantage is that multiple queries or executions may be run concurrently from the returned statement.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003ePrepare\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;SELECT * FROM posts WHERE id=$1\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Remember to always close the statement when \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// it\u0026#39;s no longer needed to free up resources\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003edefer\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eClose\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efor\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003erange\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epostIDs\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e_\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003estmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eQueryRowContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#57606a\"\u003e// Scan post\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"stored-procedures\"\u003eStored procedures\u003c/h2\u003e\n\u003cp\u003eStored procedures are user-defined functions that can be stored in the database for later reuse, they can contain parameters but can\u0026rsquo;t return anything.\u003c/p\u003e\n\u003cp\u003eAs simple as that, let\u0026rsquo;s implement a stored procedure for updating a post\u0026rsquo;s likes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e// Check if the user already liked the post, if yes, remove the like, if not, add it.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e`CREATE OR REPLACE PROCEDURE likePost(postID text, userID text) AS $$\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\tBEGIN\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\t\tIF EXISTS (SELECT 1 FROM post_likes WHERE post_id=postID AND user_id=userID) THEN\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\t   \t\tDELETE FROM post_likes WHERE post_id=postID AND user_id=userID;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\t   \tELSE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\t   \t\tINSERT INTO post_likes (post_id, user_id) VALUES (postID, userID);\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\t   \tEND IF;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\tEND \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e$$ LANGUAGE plpgsql`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExecContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eq\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe can execute it doing:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003edb\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eExecContext\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;CALL likePost($1, $2)\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003epostID\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euserID\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"parting-words\"\u003eParting words\u003c/h2\u003e\n\u003cp\u003eI hope you found this post useful, in the next one we will be taking a look at transactions (propagation using context and isolation levels), dynamic scanning, full text search, recursive queries and much more.\u003c/p\u003e\n","description":"","image":"/images/sql_go_p1.png","permalink":"https://ggp1.github.io/posts/mastering_sql_with_go_p1/","title":"Mastering SQL with Go - Part 1"},{"content":"\u003cp\u003eThe concept of containerization was first introduced in 1979 during the development of \u003ca href=\"https://en.wikipedia.org/wiki/Chroot\"\u003echroot\u003c/a\u003e (Version 7 Unix), which restricted an application\u0026rsquo;s file access to a specific directory - the root - and its children.\u003c/p\u003e\n\u003cp\u003eThe main benefit chroot brought in was \u003cstrong\u003eprocess isolation\u003c/strong\u003e, improving the system security such that an internal vulnerability wouldn\u0026rsquo;t affect external systems.\u003c/p\u003e\n\u003cp\u003eIn fact, chroot was the first of a series of technologies designed to protect each process from the others on the operating system.\u003c/p\u003e\n\u003cp\u003eMore than two decades later, in 2002, a feature called \u003cstrong\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Linux_namespaces\"\u003enamespaces\u003c/a\u003e\u003c/strong\u003e was included into the Linux kernel.\u003c/p\u003e\n\u003cp\u003eNamespaces partition kernel resources such that one set of processes sees one set of resources while another set of processes sees a different set of resources.\u003c/p\u003e\n\u003cp\u003eFive years later, engineers at Google released \u003cstrong\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Cgroups\"\u003ecgroups\u003c/a\u003e\u003c/strong\u003e, another feature that was added to the Linux kernel and that limits, accounts for, and isolates the resource usage (CPU, memory, disk I/O, network, etc.) of a collection of processes.\u003c/p\u003e\n\u003cp\u003eThe two last are the main features that the Docker Inc. took advantage of when creating the \u003ca href=\"https://www.docker.com/products/container-runtime\"\u003eDocker Engine\u003c/a\u003e container runtime in 2013, since then, containers have gained more and more adoption in the software industry all around the world.\u003c/p\u003e\n\u003ch2 id=\"containers\"\u003eContainers\u003c/h2\u003e\n\u003cp\u003eContainers encapsulate the code, libraries and configurations necessary to run an application, they offer \u003cstrong\u003eprocess-level isolation\u003c/strong\u003e and \u003cstrong\u003eshare the kernel of the host operating system\u003c/strong\u003e with other containers.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhile running in isolated processes could prevent malicious code from one container to impact others running in the same server, if there is a vulnerability in the kernel that would affect all of them indistinctively, as opposed to virtual machines that provide \u003cstrong\u003ehardware-level isolation\u003c/strong\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThe fact that they do not require an operating system per container makes them \u003cstrong\u003elightweight, portable and inexpensive\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/docker_containers.jpg\" alt=\"Docker containers running in one machine\" title=\"Docker containers running in one machine\"\u003e\u003c/p\u003e\n\u003cp\u003eMultiple containers can be created easily and fast in \u003cstrong\u003eany machine running the Docker Engine\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eLike virtual machines, they are already set up and ready for the application to run, providing a consistent solution and saving a lot of time to developers.\u003c/p\u003e\n\u003ch2 id=\"application\"\u003eApplication\u003c/h2\u003e\n\u003cp\u003eWe will use the following super simple server written in Go to demonstrate how to containerize applications efficiently:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003epackage\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;net/http\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003emain\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003ehttp\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eHandleFunc\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;/\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ehome\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ehttp\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eListenAndServe\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;:3000\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003enil\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eFatal\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#6639ba\"\u003ehome\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ew\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ehttp\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eResponseWriter\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003er\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ehttp\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eRequest\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003efmt\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#6639ba\"\u003eFprint\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ew\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;Hello world\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe docker image we are going to build is more or less similar to the ones you would use in any other compiled language so, without further ado, let\u0026rsquo;s start.\u003c/p\u003e\n\u003ch3 id=\"dockerfile\"\u003eDockerfile\u003c/h3\u003e\n\u003cp\u003eWe will start off with a \u003cstrong\u003enaive image\u003c/strong\u003e, improving it along the way and explaning the improvements.\u003c/p\u003e\n\u003cp\u003eThe directory we are using has the following structure\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e app\r\n   main.go\r\n   Dockerfile\r\n   go.mod\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eand the initial Dockerfile looks like\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e# Start from an image with the Go language and its dependencies installed\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e golang:latest\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Move into the \u0026#34;/app\u0026#34; directory (it\u0026#39;s created if not exists)\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eWORKDIR\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e /app\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Copy everything inside the host\u0026#39;s current directory into the image\u0026#39;s \u0026#34;/app\u0026#34; \u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# directory (\u0026#34;.\u0026#34; means current directory)\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# COPY \u0026lt;host src\u0026gt; \u0026lt;container dst\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e . .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Compile server and put the binary inside the image\u0026#39;s current directory, \u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# thus it will be at \u0026#34;/app/server\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# go build -o \u0026lt;path\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go build -o server\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# When the image is run in a container, execute the binary\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCMD\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;/app/server\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHaving the image specification done we only have to move into the directory containing the file and build it executing \u003ccode\u003edocker build -t server .\u003c/code\u003e, here\u0026rsquo;s the result:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/server_image0.jpg\" alt=\"Basic image\" title=\"Basic image\"\u003e\u003c/p\u003e\n\u003cp\u003eTo run the image inside a container and expose our server execute \u003ccode\u003edocker run -p 3000:3000 server\u003c/code\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe -t flag takes the image\u0026rsquo;s tag name: \u003ccode\u003e-t \u0026lt;name\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe -p flag publishes a container\u0026rsquo;s port to the host: \u003ccode\u003e-p \u0026lt;host port\u0026gt;:\u0026lt;container port\u0026gt;\u003c/code\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003ePerfect, our server is up and running, we\u0026rsquo;re done! Well, not so fast, we can do it much better.\u003c/p\u003e\n\u003ch3 id=\"image-versioning\"\u003eImage versioning\u003c/h3\u003e\n\u003cp\u003eIn our first example we didn\u0026rsquo;t specify the version of the image we started from, if the Go team releases a new version with \u003cstrong\u003ebreaking changes\u003c/strong\u003e our application will be built from it and \u003cstrong\u003epotentially break\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eTo fix this, we can visit the \u003ca href=\"https://hub.docker.com/_/golang\"\u003eGo official images on Docker Hub\u003c/a\u003e and find a version that suits our needs, in this case I\u0026rsquo;m going to use the \u003ca href=\"https://hub.docker.com/_/alpine\"\u003ealpine\u003c/a\u003e-based version.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAlpine is minimal Docker image based on Alpine Linux with a complete package index and only 5 MB in size.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e golang:1.24-alpine3.21\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWith this change only, we are going to avoid broken CI/CD pipelines and save 626 MB of space.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/server_image1.jpg\" alt=\"1.17.1-alpine3.14 version\" title=\"1.17.1-alpine3.14 version\"\u003e\u003c/p\u003e\n\u003cp\u003eThe only reason not to start from an alpine image is if it does not support a package/tool that your application requires to build or run.\u003c/p\u003e\n\u003ch3 id=\"modules-caching\"\u003eModules caching\u003c/h3\u003e\n\u003cp\u003eIf we were to develop using Docker with the image above, every change we make in the application\u0026rsquo;s code would leave Docker\u0026rsquo;s caching layer useless.\u003c/p\u003e\n\u003cp\u003eWhen building the image, dependencies are downloaded when the application is compiled (\u003ccode\u003ego build -o server\u003c/code\u003e) but if we modify a single line of code we change the directory\u0026rsquo;s content and invalidate Docker\u0026rsquo;s caching layer, forcing the process to download all the dependencies again.\u003c/p\u003e\n\u003cp\u003eIn order to fix this issue, we are going to copy and download the Go modules before any change is introduced (in other languages this may be done differently).\u003c/p\u003e\n\u003cp\u003eThe next time the image is built, they will be taken from the cache instead of re-downloaded, unless we add or remove a dependency.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e# Copy the modules file and put it in the container\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e go.mod .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Download modules\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go mod download\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Previously, this step was invalidating the cache\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e . .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Normally it would try to download the modules here but they are now cached\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go build -o server\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"removing-binary-debug-flags\"\u003eRemoving binary debug flags\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis is \u003cstrong\u003eGo-specific\u003c/strong\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThe binary size can be reduced by removing the symbol table and DWARF debugging information generation from it.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go build -o server -ldflags\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;-s -w\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"multi-stage-builds\"\u003eMulti-stage builds\u003c/h2\u003e\n\u003cp\u003eEach instruction in the dockerfile adds a layer to the image and creates artifacts for its execution, multi-stage builds allow us to copy artifacts from one stage to another and leave behind those that won\u0026rsquo;t take part in the final image.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWe are left with the image from the final stage only, the other ones behave like temporary tables/files.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eIn other words, they allow us to \u003cstrong\u003esegmentate the building process\u003c/strong\u003e in order to get to a final image containing just what we need to run our application, leaving behind the dependencies used for its compilation.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e# ----- First stage -----\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Declare this image as builder\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e golang:1.24-alpine3.21 AS builder\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eWORKDIR\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e /app\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e go.mod .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go mod download\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e . .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go build -o server -ldflags\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;-s -w\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# ----- Second stage -----\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e alpine:3.21\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Copy the binary from the builder to this image\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e --from\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003ebuilder /app/server .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCMD\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;/server\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/images/server_image2.jpg\" alt=\"Multi-stage builds\" title=\"Multi-stage builds\"\u003e\u003c/p\u003e\n\u003cp\u003eVoil! We have reduced the image size from 321MB to just 11.7MB. But this is not the end, let\u0026rsquo;s see what else can be improved.\u003c/p\u003e\n\u003ch2 id=\"limited-privileges\"\u003eLimited privileges\u003c/h2\u003e\n\u003cp\u003eContainers built with the images we just reviewed allow executing commands and can be accessed with root privileges by using \u003ccode\u003edocker exec -it \u0026lt;containerID\u0026gt; sh\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThis should be avoided at all cost since an attacker could get to the container and do whatever he pleases with it and its information.\u003c/p\u003e\n\u003cp\u003eIf for some reason you need command execution, create a user with limited privileges and switch to it like so:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e alpine:3.21\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Set USER and UID environment variables\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eENV\u003c/span\u003e \u003cspan style=\"color:#953800\"\u003eUSER\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u0026lt;username\u0026gt;\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eENV\u003c/span\u003e \u003cspan style=\"color:#953800\"\u003eUID\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u0026lt;uid\u0026gt;\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e --from\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003ebuilder /app/server .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Add user and change the binary file ownership and permissions\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e adduser \u003cspan style=\"color:#953800\"\u003e$USER\u003c/span\u003e -D -g \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e -s \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;/sbin/nologin\u0026#34;\u003c/span\u003e -u \u003cspan style=\"color:#953800\"\u003e$UID\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e chown \u003cspan style=\"color:#953800\"\u003e$USER\u003c/span\u003e /server \u003cspan style=\"color:#0a3069\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0a3069\"\u003e\u003c/span\u003e    \u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e chmod \u003cspan style=\"color:#0550ae\"\u003e0700\u003c/span\u003e /server\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Switch to the user created to execute the command as $USER\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eUSER\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e $USER\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCMD\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;/server\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"from-scratch\"\u003eFROM scratch\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003e\u003ca href=\"https://hub.docker.com/_/scratch/#!\"\u003escratch\u003c/a\u003e\u003c/em\u003e is Docker\u0026rsquo;s base image, as of version 1.5.0, is a no-op and \u003cstrong\u003ewon\u0026rsquo;t create an extra layer\u003c/strong\u003e in the image.\u003c/p\u003e\n\u003cp\u003eUsing \u003ccode\u003eFROM scratch\u003c/code\u003e signals to the build process that the next command in the Dockerfile is the first filesystem layer.\u003c/p\u003e\n\u003cp\u003eThis image doesn\u0026rsquo;t have a shell installed so it\u0026rsquo;s not possible to enter the container and execute commands, increasing the security and reducing the size of the image.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e golang:1.24-alpine3.21 AS builder\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eWORKDIR\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e /app\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e go.mod .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e go mod download\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e . .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e \u003cspan style=\"color:#953800\"\u003eCGO_ENABLED\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e0\u003c/span\u003e go build -o server -ldflags\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;-s -w\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# --------------------\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e scratch\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e --from\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003ebuilder /app/server .\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eENTRYPOINT\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;/server\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003eIn Go, it\u0026rsquo;s necessary to disable CGO (\u003ccode\u003eCGO_ENABLED=0\u003c/code\u003e) when building from scratch so the executable does not depend on the system C libraries and will embed everything it needs to run.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/images/server_image3.jpg\" alt=\"From scratch\" title=\"FROM scratch\"\u003e\u003c/p\u003e\n\u003cp\u003eIf you are looking to serve through HTTPS you will have to add the two following lines:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-dockerfile\" data-lang=\"dockerfile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e# First stage\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eRUN\u003c/span\u003e apk add --update --no-cache ca-certificates \u003cspan style=\"color:#0550ae\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e update-ca-certificates\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#57606a\"\u003e# Second stage\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eCOPY\u003c/span\u003e --from\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003ebuilder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"wrapping-up\"\u003eWrapping up\u003c/h2\u003e\n\u003cp\u003eIn summary, we have covered how to take advantage of image versioning, modules caching, limited privileges and multi-stage builds to deliver reliable, small and secure images.\u003c/p\u003e\n\u003cp\u003eFrom now on, we can run our server in any machine with Docker installed, use Kubernetes to orchestrate different copies of it and/or use a cloud provider to let the world consume our services in just a few minutes.\u003c/p\u003e\n","description":"History about and how to containerize applications","image":"/images/containers.jpg","permalink":"https://ggp1.github.io/posts/applications_containerization/","title":"Applications containerization"},{"content":"\u003cp\u003eEvery day we are more connected with our devices, we use them to share information, store capital, buy products, work, learn, for entertainment; basically anything.\u003c/p\u003e\n\u003cp\u003eAlong with these services come our accounts, that hold and will hold more value than ever as the time goes by.\u003c/p\u003e\n\u003cp\u003eThere\u0026rsquo;s no doubt we need them safe. In this article, I will try to help you \u003cstrong\u003eprotect your information\u003c/strong\u003e.\u003c/p\u003e\n\u003ch2 id=\"passwords\"\u003ePasswords\u003c/h2\u003e\n\u003cp\u003ePasswords are the \u003cstrong\u003emost critical part of every system security\u003c/strong\u003e, they are the key that protect very sensitive information so it\u0026rsquo;s specially important to understand how to manage them carefully.\u003c/p\u003e\n\u003cp\u003eThe vast majority of users typically choose simple and easy to remember passwords, or at least that\u0026rsquo;s what they try; people regularly lose access to their accounts because of forgetting them.\u003c/p\u003e\n\u003cp\u003eThere\u0026rsquo;s no much to worry about if you can\u0026rsquo;t log into an account that does not contain relevant information, but what if it has a meaningful amount of money in it, or if you use the account to work, or even if it\u0026rsquo;s the only way to access some specific data?\u003c/p\u003e\n\u003cp\u003eThese passwords commonly contain names, dates, numbers or a combination of them but this \u003cstrong\u003eis not secure\u003c/strong\u003e and should be \u003cstrong\u003eavoided\u003c/strong\u003e at all cost.\u003c/p\u003e\n\u003cp\u003eTo put it clear:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eif you reuse your passwords\u003c/li\u003e\n\u003cli\u003eor either you use one unique password per account and can remember all of them\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eit\u0026rsquo;s highly probable that they are \u003cstrong\u003eweak and easily guessable\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBy the way, using your phone\u0026rsquo;s notes or carrying around a paper with them written down in plaintext is \u003cstrong\u003eunsafe\u003c/strong\u003e and \u003cstrong\u003erisky\u003c/strong\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eA password like \u0026ldquo;masterYODA\u0026rdquo;, \u0026ldquo;anakin1706\u0026rdquo; or \u0026ldquo;-Gandalf$\u0026rdquo; can be cracked in a matter of \u003cstrong\u003eseconds\u003c/strong\u003e, the computational power of the graphic cards used for these purposes has increased \u003cstrong\u003etremendously\u003c/strong\u003e over the past decade.\u003c/p\u003e\n\u003cp\u003eWhat\u0026rsquo;s more, every year millions of them are \u003ca href=\"https://en.wikipedia.org/wiki/List_of_data_breaches\"\u003ebreached\u003c/a\u003e throughout the internet; in 2019 a single collection of 21 million passwords was for sale on the web.\u003c/p\u003e\n\u003c!-- As if this were not enough, according to Edward Snowden - NSA whistleblower - we should be prepared to protect our passwords against 1 trillion guesses per second! --\u003e\r\n\u003cblockquote\u003e\n\u003cp\u003eMany companies take exhaustive security measures to protect the users:\nencryption, bounties, \u003ca href=\"#two-factor-authentication\"\u003etwo-factor authentication\u003c/a\u003e, etc.\nNevertheless, it\u0026rsquo;s still a really hard task to accomplish, especially because internet was designed on the model of \u003cem\u003e\u0026ldquo;a group of mutually trusting users attached to a transparent network\u0026rdquo;\u003c/em\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eWhile getting your accounts compromised might seem unlikely to you, it\u0026rsquo;s a daily occurrence all around the world. It\u0026rsquo;s \u003cstrong\u003enot\u003c/strong\u003e something to get \u003cstrong\u003eparanoid\u003c/strong\u003e about but is crucial to comprehend how to defend ourselves from cybercriminals.\u003c/p\u003e\n\u003ch3 id=\"password-security\"\u003ePassword security\u003c/h3\u003e\n\u003cp\u003ePasswords\u0026rsquo; \u003cem\u003e\u0026ldquo;strength\u0026rdquo;\u003c/em\u003e is measured using a term called \u003cstrong\u003eentropy\u003c/strong\u003e. Entropy tells how hard it will be for an attacker to guess a password itself even if he knows the method used in the selection of the password.\u003c/p\u003e\n\u003cp\u003eIt is measured in bits and is calculated by doing \u003ccode\u003elog(pool length ^ secret length)\u003c/code\u003e\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e where the \u003cstrong\u003epool length\u003c/strong\u003e is the size of the group from where we take the characters and the \u003cstrong\u003esecret length\u003c/strong\u003e is how many characters the secret has.\u003c/p\u003e\n\u003cp\u003eAs you may have noticed, what makes a password \u003cstrong\u003eexponentially\u003c/strong\u003e stronger is its length. Take a look at this table\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e:\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003ePassword\u003c/th\u003e\n          \u003cth\u003ePool length\u003c/th\u003e\n          \u003cth\u003eLength\u003c/th\u003e\n          \u003cth\u003eEntropy\u003c/th\u003e\n          \u003cth\u003eNumber of possible combinations\u003c/th\u003e\n          \u003cth\u003eAverage time taken to crack\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e59e1gbis4x0k\u003c/td\u003e\n          \u003ctd\u003e36\u003c/td\u003e\n          \u003ctd\u003e12\u003c/td\u003e\n          \u003ctd\u003e62.04 bits\u003c/td\u003e\n          \u003ctd\u003e4.74 quintillion\u003c/td\u003e\n          \u003ctd\u003e27.42 days\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e8aun5 hgmy3r\u003c/td\u003e\n          \u003ctd\u003e37\u003c/td\u003e\n          \u003ctd\u003e12\u003c/td\u003e\n          \u003ctd\u003e62.51 bits\u003c/td\u003e\n          \u003ctd\u003e6.58 quintillion\u003c/td\u003e\n          \u003ctd\u003e1.27 months\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003ecv9ymuoplhk86\u003c/td\u003e\n          \u003ctd\u003e36\u003c/td\u003e\n          \u003ctd\u003e13\u003c/td\u003e\n          \u003ctd\u003e67.21 bits\u003c/td\u003e\n          \u003ctd\u003e170.58 quintillion\u003c/td\u003e\n          \u003ctd\u003e2.74 years\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eIncrementing the password\u0026rsquo;s length by 1 is \u003cstrong\u003e~26 times\u003c/strong\u003e more efficient than adding a character to the pool. This is why you want your passwords to be long rather than just replacing letters with numbers or using a couple of special characters in a short one.\u003c/p\u003e\n\u003cp\u003eFollowing this logic, nowadays, it\u0026rsquo;s suggested to use at least 18 characters and a combination of lower cases, upper cases and numbers. A password meeting these requirements looks something like: \u003ccode\u003elLk9PoOGdfW1y08qNY\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIf we want to take a step further we can add spaces and special characters: \u003ccode\u003eh\u0026gt;b)E\u0026lt;%RY/ O4|w0LK\u003c/code\u003e, this one it would take 6,385,261,034,886.48 millenniums to crack on average\u003csup id=\"fnref:3\"\u003e\u003ca href=\"#fn:3\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e3\u003c/a\u003e\u003c/sup\u003e.\u003c/p\u003e\n\u003cp\u003eAnother type of secrets are \u003cstrong\u003epassphrases\u003c/strong\u003e, sequences of words generally longer and easier to remember than passwords. For example: \u003ccode\u003emayhap shutout pomade marksmen hobbit\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThese passwords and passphrases are secure but, using the \u003cstrong\u003eexact same secret\u003c/strong\u003e for multiple accounts is a \u003cstrong\u003enaive idea\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/password_reuse.png\" alt=\"Password reuse\"\u003e\u003c/p\u003e\n\u003cp\u003eIf the details of one of your accounts gets exposed then all the others will be compromised, the attacker would have to find only their emails/usernames, which isn\u0026rsquo;t hard at all.\u003c/p\u003e\n\u003cp\u003eSo, how can someone remember even one of these long and random passwords? The answer is: there\u0026rsquo;s no reason to do it.\u003c/p\u003e\n\u003ch3 id=\"password-managers\"\u003ePassword managers\u003c/h3\u003e\n\u003cp\u003eHere\u0026rsquo;s when passwords managers come into play, they let you save your passwords securely by remembering only one, the master password, which is used to \u003cstrong\u003eencrypt\u003c/strong\u003e all the others and has to be \u003cstrong\u003eas strong as possible\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe master password should be long (I\u0026rsquo;d suggest +20 chars) and not complex enough to forget it, including special characters is a plus but not strictly necessary. Passphrases are probably what you\u0026rsquo;ll find more practical.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThis kind of applications let you generate random passwords and protect your credentials (passwords, emails, usernames, files, etc.) against the most specialized attackers by using encryption\u003csup id=\"fnref:4\"\u003e\u003ca href=\"#fn:4\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e4\u003c/a\u003e\u003c/sup\u003e and hashing, among other features.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/keyboard0.jpg\" alt=\"Keyboard\"\u003e\u003c/p\u003e\n\u003cp\u003eThere are many options on the market but I couldn\u0026rsquo;t find any that offers the enjoyable usage of the terminal, sessions and that uses one unique key for encrypting each record, instead of the whole database with the same key.\u003c/p\u003e\n\u003cp\u003eThat\u0026rsquo;s why I\u0026rsquo;ve developed \u003cstrong\u003e\u003ca href=\"https://www.github.com/GGP1/kure\"\u003eKure\u003c/a\u003e\u003c/strong\u003e, it\u0026rsquo;s free, open source and arguably one of the most secure and private password managers out there. It can also be used in almost any device or platform.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eTo give you an idea, it uses the same algorithms (\u003ca href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\"\u003eAES\u003c/a\u003e) the National Security Agency of the United States uses for encrypting \u003cstrong\u003eTop Secret\u003c/strong\u003e information as well as the \u003ca href=\"https://github.com/P-H-C/phc-winner-argon2\"\u003ePHC winner\u003c/a\u003e password hashing function.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eHowever, it\u0026rsquo;s based on the command-line and most people tend not to use it, that\u0026rsquo;s why I suggest you to try one like \u003ca href=\"https://keepassxc.org/\"\u003eKeepassXC\u003c/a\u003e, it\u0026rsquo;s free, open-source and does a really good job at keeping your data secure as well.\u003c/p\u003e\n\u003ch2 id=\"two-factor-authentication\"\u003eTwo-factor authentication\u003c/h2\u003e\n\u003ch3 id=\"time-based-one-time-passwords-totp\"\u003eTime-based one-time passwords (TOTP)\u003c/h3\u003e\n\u003cp\u003eTwo-factor authentication is a form of identification that strengthens an account\u0026rsquo;s security by requiring the user to enter a \u003cstrong\u003ecode\u003c/strong\u003e that can be stored in an authentication app or received via sms/email.\u003c/p\u003e\n\u003cp\u003eSo apart from something the user knows (\u003cem\u003epassword\u003c/em\u003e), now it is required something it has aswell (\u003cem\u003edevice/service\u003c/em\u003e that provides the code).\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eSMS and email are especially susceptible to phishing attacks, prioritize using an application (optimally an open-source one) as it doesn\u0026rsquo;t share the code with anyone.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/images/2fa.jpg\" alt=\"TOTP authentication example\" title=\"Time-based one-time passwords\"\u003e\u003c/p\u003e\n\u003cp\u003eThe code is time-based and it refreshes every 30 seconds, to generate the same code, the client and the server utilize a setup key and the number of seconds that have elapsed since the 00:00:00 UTC on 1 January 1970 (Unix epoch).\u003c/p\u003e\n\u003cp\u003eTOTPs makes it, not impossible, but much more complicated for an attacker to access an account as it now needs to get its hands on the \u003cstrong\u003econstantly refreshing\u003c/strong\u003e code.\u003c/p\u003e\n\u003ch3 id=\"security-keys\"\u003eSecurity keys\u003c/h3\u003e\n\u003cp\u003eSecurity keys provide another way of \u003cem\u003etwo-factor authentication\u003c/em\u003e, they generate codes \u003cstrong\u003elocally\u003c/strong\u003e with the \u003cstrong\u003ehardware\u003c/strong\u003e they have integrated, taking advantage of isolation and ensuring the security of the secret generation process.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThese devices can be used for producing static passwords, digital signatures, OTP, TOTPs and more.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThey add another requirement to the authentication of the user which is having access to the physical device.\u003c/p\u003e\n\u003ch2 id=\"encrypted-connections\"\u003eEncrypted connections\u003c/h2\u003e\n\u003cp\u003eIt\u0026rsquo;s crucial to ensure that the services we use offer \u003cstrong\u003eend-to-end encrypted connections\u003c/strong\u003e, this means that anyone trying to access the information being sent and received will have to decrypt it, which demands a huge amount of time and computational power.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMost services\u0026rsquo; connections are established with \u003cstrong\u003eHTTPS\u003c/strong\u003e (\u003ca href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\"\u003eHTTP\u003c/a\u003e + \u003ca href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\"\u003eTLS\u003c/a\u003e), also known as the green lock before the address box. There are some browser settings and extensions that force HTTPS or warn you if a site does not support it.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/images/https.png\" alt=\"HTTPS\" title=\"Verified TLS cerificate\"\u003e\u003c/p\u003e\n\u003cp\u003eYou should \u003cstrong\u003enever\u003c/strong\u003e send sensitive information over a \u003cstrong\u003enon-encrypted connection\u003c/strong\u003e, otherwise, anyone \u003ca href=\"https://www.paessler.com/it-explained/packet-sniffing\"\u003esniffing\u003c/a\u003e the connection is able to read \u003cstrong\u003eevery single byte of data\u003c/strong\u003e.\u003csup id=\"fnref:5\"\u003e\u003ca href=\"#fn:5\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e5\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003ch2 id=\"limited-data-sharing\"\u003eLimited data sharing\u003c/h2\u003e\n\u003cp\u003eThe best way to protect your data is, of course, not sharing it. Specially if we consider that companies may exchange information between them, with government agencies and other institutions.\u003c/p\u003e\n\u003cp\u003eIt\u0026rsquo;s better \u003cstrong\u003enot\u003c/strong\u003e to enter any private information unless \u003cstrong\u003estrictly necessary\u003c/strong\u003e, either when the service or other users need to link the account with your identity, otherwise it\u0026rsquo;s preferable to use false profiles.\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eDigital information is protected by the knowledge of other information (keys, secrets, codes), we can conclude, then, that \u003cstrong\u003ethe confidentiality of some information is proportional to the difficulty of guessing or getting access to the secrets that secure it\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eWe have covered a few topics concerning computer networks security, there are still more advanced ones, such as cryptography and advanced hacking techniques but they will be referenced in future blogs.\u003c/p\u003e\n\u003cp\u003eFor now, implementing the security measures that were introduced above will \u003cstrong\u003edramatically decrease\u003c/strong\u003e the chances of someone else getting access to your information.\u003c/p\u003e\n\u003cdiv class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\"\u003e\n\u003cp\u003e\u003ccode\u003epool length ^ secret length\u003c/code\u003e is the number of possible combinations and \u003ccode\u003elog\u003c/code\u003e is used to calculate this information in bits, as each bit has 2 possible states. This helps simplifying large numbers, for example, \u003ccode\u003elog(70,000,000) = 26.06 bits\u003c/code\u003e.\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\"\u003e\n\u003cp\u003eThese values are based on a \u003cstrong\u003ebrute force attack\u003c/strong\u003e and the time taken will \u003cstrong\u003echange\u003c/strong\u003e as computers become more powerful.\u003c/p\u003e\n\u003cp\u003eA brute force attack consists in trying every possible combination of characters, the average number of attempts that will take an attacker to find the key is \u003cstrong\u003e50% percent\u003c/strong\u003e of the total, and that\u0026rsquo;s the scenario we are considering.\u003c/p\u003e\n\u003cp\u003eThere are other techniques like \u003cstrong\u003esocial engineering\u003c/strong\u003e, \u003cstrong\u003edictionary\u003c/strong\u003e and \u003cstrong\u003eprecomputation attacks\u003c/strong\u003e, etc. that are more advanced and will require an entire blog to explain them, but you can imagine that if someone wants to get acess to your account, he will have tools to help him.\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:3\"\u003e\n\u003cp\u003ePasswords, passphrases and their security details displayed in this article were provided by a library I created for generating cryptographically secure and higly random secrets called \u003ca href=\"https://www.github.com/GGP1/atoll\"\u003eAtoll\u003c/a\u003e.\u0026#160;\u003ca href=\"#fnref:3\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:4\"\u003e\n\u003cp\u003eEncryption is the process of encoding information with a secret, so only the users knowing the secret can decode it.\u003c/p\u003e\n\u003cp\u003eEncryption is used to ensure \u003cstrong\u003edata confidentiality and integrity\u003c/strong\u003e while acting as an \u003cstrong\u003eauthentication\u003c/strong\u003e mechanism at the same time. The techniques used for these purposes are generally published, standardized and available to everyone.\u0026#160;\u003ca href=\"#fnref:4\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:5\"\u003e\n\u003cp\u003eVPNs won\u0026rsquo;t be taken into consideration because:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003ethey don\u0026rsquo;t offer end-to-end encryption (only to/from the VPN server)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eif we are communicating with one or more users our information will still be vulnerable (their connections aren\u0026rsquo;t encrypted)\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ethe user\u0026rsquo;s privacy may be compromised\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003esome services block connections received from indentified VPN servers to protect region-specific content\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u0026#160;\u003ca href=\"#fnref:5\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n","description":null,"image":"/images/data_protection.jpg","permalink":"https://ggp1.github.io/posts/protect_your_information/","title":"Protect your information"},{"content":"\u003cp\u003eReact Native\u0026rsquo;s \u003cem\u003eFlatList\u003c/em\u003e is a component that supports many cool features while being simple and easy to use, it\u0026rsquo;s a good example of a well-designed piece of software and that\u0026rsquo;s why I decided to take it a step further.\u003c/p\u003e\n\u003cp\u003eFor that, I\u0026rsquo;ve developed a generic list built on top of it that handles \u003cstrong\u003epagination\u003c/strong\u003e and \u003cstrong\u003erefreshing\u003c/strong\u003e internally, reducing a \u003cem\u003elot\u003c/em\u003e of repetitive code from my previous implementation.\u003c/p\u003e\n\u003cp\u003eI looked for something like this online but couldn\u0026rsquo;t find anything similar, even though it might be useful for many people, so I decided to share it.\u003c/p\u003e\n\u003cp\u003eHere\u0026rsquo;s the snippet with the entire code, let\u0026rsquo;s take a brief look and review it in detail later:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eReact\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseCallback\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseEffect\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;react\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eFlatList\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eFlatListProps\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;react-native\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003einterface\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eID\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eFLProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eOmit\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eFlatListProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;data\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;keyExtractor\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;onEndReached\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;onRefresh\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;refreshing\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003einterface\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eextends\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eFLProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003efetchItems\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor?\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[]]\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eList\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eextends\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eID\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eprops\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003eProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;)\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003ereadonly\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003erefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetRefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eboolean\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003efalse\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseCallback\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003etry\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enextCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eelems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003efetchItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003esetCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enextCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e?\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003econcat\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eelems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e))\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eelems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003ecatch\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003econsole\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003efinally\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003esetRefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003efalse\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e},\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003euseEffect\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e},\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eFlatList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003ekeyExtractor\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitem\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eitem\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003eonEndReached\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{({\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edistanceFromEnd\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e})\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#1f2328\"\u003edistanceFromEnd\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e?\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eundefined\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003eonEndReachedThreshold\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#1f2328\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eonEndReachedThreshold\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e?\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eprops.onEndReachedThreshold\u003c/span\u003e : \u003cspan style=\"color:#cf222e\"\u003e0.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003erefreshing\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003erefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003eonRefresh\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#1f2328\"\u003esetRefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#1f2328\"\u003esetCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e...props\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"list-in-action\"\u003e\u003ccode\u003eList\u003c/code\u003e in action\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eimport\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eList\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;./List\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eUser\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#1f2328\"\u003eusername\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eUserList\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003egetUsers\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor?\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eUser\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[]]\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eresponse\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003efetch\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e`localhost:4000/users?cursor=\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#0a3069\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// In this example, the response body contains a JSON object with \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#57606a\"\u003e// the next cursor and an array of users\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ejson\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eresponse\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eas\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enext_cursor\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eusers\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003eUser\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[]};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enext_cursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eusers\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eList\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eUser\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003efetchItems\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003egetUsers\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003erenderItem\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{({\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eitem\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e})\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eView\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eText\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitem\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eusername\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u0026lt;/\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eText\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eView\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#1f2328\"\u003enumColumns\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e2\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#57606a\"\u003e// More properties from FlatList may be included here\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#57606a\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAs you can see, it\u0026rsquo;s extremely easy to use and requires few lines of code to have it working.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote two things, \u003ccode\u003e\u0026lt;User\u0026gt;\u003c/code\u003e makes explicit the type of items the list will contain and\n\u003ccode\u003enext_cursor\u003c/code\u003e must always return a non-null value, if not, the request will return duplicated items.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"component-breakdown\"\u003eComponent breakdown\u003c/h2\u003e\n\u003ch3 id=\"properties\"\u003eProperties\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003einterface\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eID\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eid\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eFLProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eOmit\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eFlatListProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#0a3069\"\u003e\u0026#34;data\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;keyExtractor\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;onEndReached\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;onRefresh\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#0a3069\"\u003e\u0026#34;refreshing\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003einterface\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eextends\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eFLProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003efetchItems\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor?\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003ePromise\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e[]]\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eList\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eextends\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eID\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eprops\u003c/span\u003e: \u003cspan style=\"color:#cf222e\"\u003eProps\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;)\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe \u003ccode\u003eID\u003c/code\u003e interface is used for the generic to accept only items that has and id field in it, which is used to extract a unique key from each of them.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eFLProps\u003c/code\u003e contains all the properties of a \u003ccode\u003eFlatList\u003c/code\u003e except the ones that are specified with literal strings, preventing the caller from overwriting the properties that are automatically handled by the component.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIn my case I was always using the types\u0026rsquo; id field to uniquely identify items inside the list but if it\u0026rsquo;s not your case, \u003ccode\u003ekeyExtractor\u003c/code\u003e can be delegated.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eLastly, the component\u0026rsquo;s properties are all of \u003ccode\u003eFLProps\u003c/code\u003e plus \u003ccode\u003efetchItems\u003c/code\u003e, the callback from which the list will be populated.\u003c/p\u003e\n\u003ch3 id=\"state\"\u003eState\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003ereadonly\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eT\u003c/span\u003e\u003cspan style=\"color:#f6f8fa;background-color:#82071e\"\u003e[]\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003estring\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003erefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetRefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseState\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003eboolean\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026gt;(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003efalse\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eitems\u003c/code\u003e holds the elements list, it\u0026rsquo;s set to read-only as the items themselves won\u0026rsquo;t be modified. Always try to type as much as possible.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecursor\u003c/code\u003e contains the id of the element used to tell the server the starting point for a new list of elements.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erefreshing\u003c/code\u003e stores a boolean that tells whether the list is waiting for more values or not.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"get-items-callback\"\u003eGet items callback\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003euseCallback\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#cf222e\"\u003etry\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#cf222e\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enextCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e,\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eelems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e]\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003efetchItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003ecursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003esetCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003enextCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e?\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eitems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003econcat\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eelems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e))\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eelems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003ecatch\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003econsole\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eerr\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003efinally\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003esetRefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003efalse\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e},\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere\u0026rsquo;s where most of the list\u0026rsquo;s work is done, we fetch items from a source - tipically an HTTP request to a server - using a cursor (initially undefined), so we will never get a duplicated item.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003euseCallback\u003c/code\u003e returns a memoized version of the callback that changes only when one of its dependencies has changed.\u003c/p\u003e\n\u003cp\u003eIn this case it has none to execute the callback only when we explicity specify it and to prevent unnecessary renders from \u003ccode\u003euseEffect\u003c/code\u003e.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThe received cursor is stored for use in following calls and, if there are already stored items, the ones from the next request are appended to them.\u003c/p\u003e\n\u003cp\u003eAny potential error is catched and logged into the console.\u003c/p\u003e\n\u003cp\u003eFinally, \u003ccode\u003erefreshing\u003c/code\u003e is set to false to tell the list that we are done getting new values.\u003c/p\u003e\n\u003ch3 id=\"use-effect-hook\"\u003eUse effect hook\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003euseEffect\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e},\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e[]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003euseEffect\u003c/code\u003e runs once and gets the items that the list will contain when the component is mounted, the cursor will always be undefined.\u003c/p\u003e\n\u003ch3 id=\"pagination\"\u003ePagination\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e_\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eonEndReached\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{({\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003edistanceFromEnd\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e})\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003edistanceFromEnd\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e\u0026lt;\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e?\u003c/span\u003e \u003cspan style=\"color:#cf222e\"\u003eundefined\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eonEndReachedThreshold\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003eonEndReachedThreshold\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e?\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003eprops.onEndReachedThreshold\u003c/span\u003e : \u003cspan style=\"color:#cf222e\"\u003e0.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003eonEndReached\u003c/code\u003e is the callback that will be called whenever the user reaches the end of the list, in this case it will request more items to the server, using the cursor to specify the last item of the latest response.\u003c/p\u003e\n\u003cp\u003eThere are some scenarios when the list is first rendered but it has so few items that it triggers the \u003ccode\u003eonEndReached\u003c/code\u003e callback, forcing another render.\u003c/p\u003e\n\u003cp\u003eIn order to avoid this, \u003ccode\u003edistanceFromEnd\u003c/code\u003e (always negative on the first render) is set to undefined in those cases.\u003c/p\u003e\n\u003ch3 id=\"refreshing\"\u003eRefreshing\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-tsx\" data-lang=\"tsx\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e_\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003erefreshing\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003erefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003eonRefresh\u003c/span\u003e\u003cspan style=\"color:#0550ae\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e{()\u003c/span\u003e \u003cspan style=\"color:#0550ae\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan style=\"color:#1f2328\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003esetRefreshing\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003etrue\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003esetCursor\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003esetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#cf222e\"\u003eundefined\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#1f2328\"\u003egetItems\u003c/span\u003e\u003cspan style=\"color:#1f2328\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#1f2328\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#1f2328\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEach time the list is pulled the \u003ccode\u003eonRefresh\u003c/code\u003e callback is triggered.\u003c/p\u003e\n\u003cp\u003eIn it, the list is set to its refreshing state, the component\u0026rsquo;s state is reset and new items are requested. It\u0026rsquo;s like simulating the component\u0026rsquo;s first render.\u003c/p\u003e\n\u003ch3 id=\"potential-enhancements\"\u003ePotential enhancements\u003c/h3\u003e\n\u003cp\u003eThis is a simplified version of the List component I use so there are things that may be missing for your implementation.\u003c/p\u003e\n\u003cp\u003eOne kind of obvious is the possibility that \u003ccode\u003efetchItems\u003c/code\u003e returns undefined data.\u003c/p\u003e\n\u003cp\u003eSome others may be:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePassing more parameters to the fetch items callback.\u003c/li\u003e\n\u003cli\u003eSet a limit to the amount of items that can be stored.\u003c/li\u003e\n\u003cli\u003eUse a reference to a boolean value to avoid requesting items on an unmounted list.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eExtending its utility it\u0026rsquo;s up to your imagination and I hope this post has inspired you to create useful generic components.\u003c/p\u003e\n","description":"React Native List example","image":"/images/rn_list.png","permalink":"https://ggp1.github.io/posts/rn_generic_list/","title":"React Native generic list"},{"content":"\u003cp\u003eThe stability of modern monetary systems depends on people\u0026rsquo;s trust on the governments and institutions that rule them.\u003c/p\u003e\n\u003cp\u003eCentral banks impose the currencies used and arbitrarily control money supply and interest rates. Their negligent manipulation have caused inflation and hiperinflation crises all over the world, driving people to look for better ways of storing their capital to protect it from money debasement.\u003c/p\u003e\n\u003cp\u003eThe search for a solution along with the advances in computer science and cryptography led to the creation of a decentralized virtual system that does not require to trust on a third party to exchange assets in a secure, transparent and reliable manner. This system is called \u003cstrong\u003eBitcoin\u003c/strong\u003e.\u003c/p\u003e\n\u003ch1 id=\"history\"\u003eHistory\u003c/h1\u003e\n\u003cp\u003eWith World War II coming to and end in 1944, 44 alied nations celebrated the \u003ca href=\"https://en.wikipedia.org/wiki/Bretton_Woods_system\"\u003eBretton Woods\u003c/a\u003e agreement that established the rules, institutions and procedures that would regulate the international monetary system after the war.\u003c/p\u003e\n\u003cp\u003eThe countries agreed on fixing their currencies to the U.S. dollar, and to tie the U.S. dollar to gold at a price of $35 per ounce. The currencies were now (supposedly) \u003cstrong\u003eindirectly backed by and exchangeable for gold\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/bretton_woods_conference.jpg\" alt=\"Bretton Woods Conference\" title=\"Bretton Woods Conference\"\u003e\u003c/p\u003e\n\u003cp\u003eA few years later, a series of conflicts known as the \u003ca href=\"https://www.history.com/topics/cold-war/cold-war-history\"\u003eCold War\u003c/a\u003e started between the United States, the Soviet Union and their respective allies. To face them, the United States began spending high amounts of money and in 1950 its balance of payments swung negative.\u003c/p\u003e\n\u003cp\u003eWhat\u0026rsquo;s worse, in 1964-1965 its president \u003cstrong\u003eLyndon Johnson\u003c/strong\u003e launched the \u003ca href=\"https://www.history.com/topics/1960s/great-society\"\u003eGreat Society Program\u003c/a\u003e, a set of domestic programs to eliminate poverty, reduce crime, abolish inequality and improve the environment, which represented even more deficit.\u003c/p\u003e\n\u003cp\u003eAs a consequence of all these spending, other countries became concern that the U.S. didn\u0026rsquo;t have enough gold reserves to back the money that was being printed and started exchanging their dollars for gold and demanding physical delivery.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003ePreviously, the exchanges of currencies for gold were done within the banks of the U.S. to avoid the logistics of shipping the gold.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eTo prevent the outflow of gold, the American President \u003cstrong\u003eRichard Nixon\u003c/strong\u003e suspended \u003cem\u003e\u0026ldquo;temporarily\u0026rdquo;\u003c/em\u003e the convertibility of the U.S. dollar to gold or other reserve assets in August 15, 1971. In March 1973 the fixed exchange rate system became a floating exchange rate system, giving birth to \u003cstrong\u003efiat currencies\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eFiat currencies are, by definition, backed by \u003cstrong\u003enothing other than government promises and people\u0026rsquo;s faith on them\u003c/strong\u003e. They are measured only against each other and can be easily manipulated.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.merriam-webster.com/dictionary/fiat\"\u003eFiat\u003c/a\u003e (decree) means \u0026ldquo;authoritative or arbitrary order\u0026rdquo;.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/images/fiat_currencies.jpg\" alt=\"Fiat currencies\"\u003e\u003c/p\u003e\n\u003cp\u003eWith the objective of offering an alternative to the traditional financial system, several entities tried implementing their own private currencies that were tied not to trust but to reserves of precious metals, like most nations used to do prior to the Bretton Woods agreement:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eE-gold\u003c/strong\u003e: a digital currency backed with gold coins and operated by Gold \u0026amp; Silver Reserve Inc. (U.S.) that allowed users to transfer value from one account to another instantly inside their website.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLiberty Reserve\u003c/strong\u003e: similarly to e-gold, it was a digital currency that let users transfer money through a website with low transaction fees. Deposited funds where converted to Liberty Reserve Dollars that were tied to the U.S. dollar or to ounces of gold.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLiberty dollar\u003c/strong\u003e: a private currency that was issued in minted metal rounds (similar to coins), gold and silver certificates and electronic currency (eLD). Liberty Dollars were backed by gold, silver, platinum, or copper.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAll three services were shut down by the United States government, charging their owners with federal crimes for money counterfeiting, laundering and conspiracy.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe U.S. government also \u003ca href=\"https://www.law.cornell.edu/uscode/text/18/486\"\u003eprohibited\u003c/a\u003e the use of silver bullion, or any other metal coin or bar not issued under government authority, from being used as currency in commerce.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThese projects provided a refuge against fiat currencies\u0026rsquo; inflation and a simple and fast way of transferring value, however, their users were \u003cstrong\u003estill required to trust a central authority\u003c/strong\u003e and their reserves and services management.\u003c/p\u003e\n\u003cp\u003eMany researchers and computer scientists became aware that removing trust from the equation could only be achieved by a \u003cstrong\u003edecentralized and distributed system\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIn 1998, \u003cstrong\u003eWei Dai\u003c/strong\u003e \u003ca href=\"http://www.weidai.com/bmoney.txt\"\u003erevealed\u003c/a\u003e \u003cstrong\u003eB-Money\u003c/strong\u003e, a distributed electronic cash system described by his author as \u003cem\u003e\u0026ldquo;a scheme for a group of untraceable digital pseudonyms to pay each other with money and to enforce contracts amongst themselves without outside help\u0026rdquo;\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eWei\u0026rsquo;s proposal emphasizes in \u003cstrong\u003eusers\u0026rsquo; participation\u003c/strong\u003e to maintain a separate database containing all participants\u0026rsquo; accounts balances, solve computational problems to create money, and validate, conclude and enforce contracts.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe idea of digital cash was originally introduced in a research paper called \u003cem\u003e\u003ca href=\"https://www.chaum.com/publications/Chaum-blind-signatures.PDF\"\u003e\u0026ldquo;Blind signatures for untraceable payments\u0026rdquo;\u003c/a\u003e\u003c/em\u003e wrote by \u003cstrong\u003eDavid Chaum\u003c/strong\u003e in 1983. However, David\u0026rsquo;s goal wasn\u0026rsquo;t a monetary reform but to give the individuals control over their own information.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eThis same year, \u003cstrong\u003e\u003ca href=\"https://nakamotoinstitute.org/bit-gold/\"\u003eBit Gold\u003c/a\u003e\u003c/strong\u003e showed up. It was proposed by \u003cstrong\u003eNick Szabo\u003c/strong\u003e in an attempt to provide a solution to money counterfeiting, theft and its value depending on a trusted central authority.\u003c/p\u003e\n\u003cp\u003eThe idea behind Bit Gold was an online automated currency with \u003cstrong\u003eminimal dependence on trusted third parties\u003c/strong\u003e and that could be securely stored, transferred, and assayed with similar minimal trust.\u003c/p\u003e\n\u003cp\u003eIn 2005, Nick wrote a \u003ca href=\"https://unenumerated.blogspot.com/2005/12/bit-gold.html\"\u003epost\u003c/a\u003e were he mentioned interesting notions like \u003cstrong\u003eproof of work securely timestamped\u003c/strong\u003e, \u003cstrong\u003edistributed property title registry\u003c/strong\u003e and a \u003cstrong\u003echain of string bits\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eAltough B-Money and Bit Gold were never implemented, many of their concepts were later used in the creation of the first and currently most popular digital currency.\u003c/p\u003e\n\u003cp\u003eOn February, 2009 an individual/group under the name of \u003cstrong\u003eSatoshi Nakamoto\u003c/strong\u003e, whose identity is still unknown, \u003ca href=\"https://p2pfoundation.ning.com/forum/topics/bitcoin-open-source\"\u003eposted\u003c/a\u003e that he has developed a new open source P2P (peer-to-peer\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003e) e-cash system called \u003cstrong\u003e\u003ca href=\"https://bitcoin.org/bitcoin.pdf\"\u003eBitcoin\u003c/a\u003e\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eBitcoin replaces trust based models with a \u003cstrong\u003edecentralized electronic payment system based on cryptographic proof\u003c/strong\u003e.\u003c/p\u003e\n\u003ch1 id=\"bitcoin\"\u003eBitcoin\u003c/h1\u003e\n\u003cp\u003eBitcoin is a \u003cstrong\u003edigital asset whose integrity is protected by cryptography\u003c/strong\u003e\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e. It is decentralized, divisible and fungible.\u003c/p\u003e\n\u003cp\u003eIn other words, it\u0026rsquo;s essentially \u003cstrong\u003ebits of information that represent value\u003c/strong\u003e inside a virtual system, which is designed to provide a secure, transparent and reliable infrastructure for their exchange.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/bitcoin.jpg\" alt=\"Bitcoin\"\u003e\u003c/p\u003e\n\u003cp\u003eBitcoin offers a \u003cstrong\u003epublic way for two parties to exchange property titles with no trust on any third party\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThey are easy to store and transport, and enable the possibility to transfer assets with no economic, geographical nor political limitations and without relying on states, banks or other central institutions for it.\u003c/p\u003e\n\u003cp\u003eThe technology that powers Bitcoin and provides a way of achieving such challenges is known as \u003cem\u003eblockchain\u003c/em\u003e.\u003c/p\u003e\n\u003ch2 id=\"blockchain\"\u003eBlockchain\u003c/h2\u003e\n\u003cp\u003eA blockchain is a \u003ca href=\"https://en.wikipedia.org/wiki/Distributed_ledger\"\u003e\u003cstrong\u003edistributed ledger\u003c/strong\u003e\u003c/a\u003e (append-only database) managed by a decentralized network that stores information (typically transactions) grouped in blocks. Each block is linked to the previous one in the chain and contains:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ea \u003cem\u003ehash\u003c/em\u003e\u003csup id=\"fnref:3\"\u003e\u003ca href=\"#fn:3\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e3\u003c/a\u003e\u003c/sup\u003e of the current block\u0026rsquo;s content\u003c/li\u003e\n\u003cli\u003ethe hash of the previous block\u003c/li\u003e\n\u003cli\u003ea \u003ca href=\"https://en.wikipedia.org/wiki/Cryptographic_nonce\"\u003enonce\u003c/a\u003e (number used only once)\u003c/li\u003e\n\u003cli\u003ea timestamp\u003c/li\u003e\n\u003cli\u003eother information (bits, weight, size, merkle root, number of transactions, difficulty, etc.).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/images/blockchain_blocks.png\" alt=\"Blockchain blocks content\" title=\"Blockchain blocks content\"\u003e\u003c/p\u003e\n\u003cp\u003eThese blocks are \u003cstrong\u003eimmutable\u003c/strong\u003e, they cannot be modified once they are appended to the database.\u003c/p\u003e\n\u003cp\u003eThe only way to change some information is to replace the entire block and produce the largest chain, as we will see later, this is \u003cstrong\u003eextremelly difficult and lacks incentives\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThis immutability provides great \u003cstrong\u003etransparency\u003c/strong\u003e to the system, absolutely all the blocks and their information can be seen by anyone, anytime. Take a look at the first block of the Bitcoin blockchain \u003ca href=\"https://www.blockchain.com/btc/block/0\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBlockchains storing transactions within a block organize them by using a \u003ca href=\"https://en.wikipedia.org/wiki/Merkle_tree\"\u003emerkle tree\u003c/a\u003e to verify their integrity.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eFor a block to take part of the blockchain, the \u003ca href=\"https://en.bitcoin.it/wiki/Full_node\"\u003efull nodes\u003c/a\u003e on the network must agree that it contains legitimate information.\u003c/p\u003e\n\u003cp\u003eEach \u003cem\u003efull node\u003c/em\u003e holds a copy of the entire database and validates that the transactions and blocks meet the \u003cstrong\u003eblockchain\u0026rsquo;s consensus rules\u003c/strong\u003e, communicating its decisions to the others in the network. It also updates the copy as new blocks are added.\u003c/p\u003e\n\u003cp\u003eCoordinating all the nodes is a complex problem in a \u003cstrong\u003edistributed system\u003c/strong\u003e and the reason why many \u003cstrong\u003econsensus mechanisms\u003c/strong\u003e were created.\u003c/p\u003e\n\u003ch3 id=\"distributed-systems-and-consensus-mechanisms\"\u003eDistributed systems and consensus mechanisms\u003c/h3\u003e\n\u003cp\u003eA \u003cstrong\u003edistributed system\u003c/strong\u003e is a group of computers (also referred as nodes) operating independently and communicating between each other to exchange and agree on information to perform a task.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/consensus_mechanisms.png\" alt=\"Consensus mechanisms\"\u003e\u003c/p\u003e\n\u003cp\u003eA blockchain network is one of them, it requires to be \u003cstrong\u003ereliable, consistent and fault-tolerant\u003c/strong\u003e but also needs a way of ensuring that the nodes spend \u003cstrong\u003escarce resources\u003c/strong\u003e (electricity, time, etc.) in order to be elegible and participate in the system, otherwise any of them could attempt to inject malicious blocks without much endeavor.\u003c/p\u003e\n\u003cp\u003eThere are multiple mechanisms to achieve this, the two most used in blockchain technologies are \u003cem\u003eproof of work\u003c/em\u003e\u003csup id=\"fnref:4\"\u003e\u003ca href=\"#fn:4\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e4\u003c/a\u003e\u003c/sup\u003e and \u003cem\u003eproof of stake\u003c/em\u003e.\u003c/p\u003e\n\u003ch3 id=\"proof-of-work\"\u003eProof of work\u003c/h3\u003e\n\u003cp\u003eIn a proof of work (PoW) system, blocks are added to the blockchain by \u003cstrong\u003eminers\u003c/strong\u003e, which are nodes that compete against each other to \u003cstrong\u003ecompute a hash\u003c/strong\u003e that is lower than the \u003cstrong\u003etarget\u003c/strong\u003e\u003csup id=\"fnref:5\"\u003e\u003ca href=\"#fn:5\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e5\u003c/a\u003e\u003c/sup\u003e. This calculation is \u003cstrong\u003ecomputationally expensive\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eTo produce the hash, a miner takes the current block content, the previous block\u0026rsquo;s hash and a nonce (number used only once).\u003c/p\u003e\n\u003cp\u003eWhat miners try to brute-force is the \u003cstrong\u003enonce\u003c/strong\u003e, they do the calculation over and over again changing its value to get different hashes and hopefully one that is correct.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe target difficulty is adjusted by reducing its value (hence reducing the probability of getting a valid hash) to keep block creation at a certain rate (1 per 10 minutes in the case of Bitcoin).\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eOnce a miner finds (or thinks it has) the solution, it broadcasts the hash to the other nodes for them to verify if it is correct, this is done fast as the verification demands a single calculation.\u003c/p\u003e\n\u003cp\u003eIn case the solution is valid, the miner is \u003cstrong\u003erewarded\u003c/strong\u003e with a pre-established amount of coins that may or may not vary over time depending on how the system is configured.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/pow.jpg\" alt=\"Proof of work\" title=\"Proof of work\"\u003e\u003c/p\u003e\n\u003cp\u003eIn a blockchain using proof of work, its security relies on the \u003cstrong\u003edifficulty of accumulating CPU power\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThe network always trusts and replicates the \u003cstrong\u003elongest\u003c/strong\u003e valid chain, hence, corrupting it is only possible by \u003cstrong\u003emining faster than the rest of the network\u003c/strong\u003e (having more than 50% of the network\u0026rsquo;s CPU power), this is, producing the longest branch of blocks and making the nodes discard the \u0026ldquo;honest\u0026rdquo; one.\u003c/p\u003e\n\u003cp\u003eThis attack can change the current/future transactions but won\u0026rsquo;t affect previously stored ones. Modifying a past transaction is even harder:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/proof_of_work.png\" alt=\"Proof of work attack\"\u003e\u003c/p\u003e\n\u003ch4 id=\"computational-scalability\"\u003eComputational scalability\u003c/h4\u003e\n\u003cp\u003eAs the probability of guessing a right hash is \u003cstrong\u003edirectly proportional\u003c/strong\u003e to the hashes per second the miner is able to perform, there is a race going on to make those hashes as fast as possible, which translates in high levels of electricity consumption.\u003c/p\u003e\n\u003cp\u003eThis is one of the main criticisms to proof of work systems, considered by some as \u003cem\u003e\u0026ldquo;extremely inefficient\u0026rdquo;\u003c/em\u003e. However, it\u0026rsquo;s clear that such an effort needs to be made to keep the blockchain secure and thus, \u003cstrong\u003eprotect the users\u0026rsquo; property\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eCryptocurrencies using a proof of work system \u003cstrong\u003etrade computational scalability for social scalability\u003c/strong\u003e\u003csup id=\"fnref:6\"\u003e\u003ca href=\"#fn:6\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e6\u003c/a\u003e\u003c/sup\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/crypto_mine.jpg\" alt=\"Cryptocurrency mine\" title=\"Thousands of computers calculating hashes in a cryptocurrency mine\"\u003e\u003c/p\u003e\n\u003ch2 id=\"finance\"\u003eFinance\u003c/h2\u003e\n\u003cp\u003eNow that we know what a blockchain is and what it can be used for, let\u0026rsquo;s get an insight on Bitcoin price and how users store and exchange satoshis (Bitcoin\u0026rsquo;s smallest denomination).\u003c/p\u003e\n\u003ch3 id=\"wallets\"\u003eWallets\u003c/h3\u003e\n\u003cp\u003eThe users, in order to interact with the blockchain and make transactions, need a \u003cstrong\u003ewallet\u003c/strong\u003e. A wallet is an application that acts as an interface for the users to send and receive coins inside the blockchain. Each wallet has a \u003cstrong\u003epublic and private key\u003c/strong\u003e which are used to \u003cstrong\u003esign and verify\u003c/strong\u003e transactions.\u003c/p\u003e\n\u003cp\u003eThe public key is used to identify a wallet, it could be thought as a unique address/username.\u003c/p\u003e\n\u003cp\u003eThe private key is required to verify the ownership of the coins that are under the wallet with its public key pair. Losing it means losing access to all the coins.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eImportant\u003c/strong\u003e: when you buy Bitcoin in an exchange, they are stored in a wallet owned by that exchange, it\u0026rsquo;s not safe to keep the coins there as they are the main target of cybercriminals, plus you don\u0026rsquo;t really own them. When you withdraw your funds is when they are sent to your wallet (the one protected by your private key and under your control). Not your keys, not your coins.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eWallets are tipically divided by their internet connectivity into two categories:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eHot wallets\u003c/strong\u003e: they are connected to the internet and suitable for daily transactions but not for long-term holding as they are more prone to attacks.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCold wallets\u003c/strong\u003e: they offer higher security by handling the keys in an isolated and offline device (or a paper), ideally for holding.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe two most used types of wallets are hardware and software (desktop, mobile, web) but their differences won\u0026rsquo;t be covered in this post, I invite you to investigate yourself.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"transactions\"\u003eTransactions\u003c/h3\u003e\n\u003cp\u003eTransactions are token transfers between two users \u003cstrong\u003ewithin the blockchain\u003c/strong\u003e and each one of them has a \u003cstrong\u003efee\u003c/strong\u003e that is rewarded to the miner for calculating the hash of the block.\u003c/p\u003e\n\u003cp\u003eUsers are in charge of choosing the amount they want to destinate to the fee, transactions offering a higher reward/byte ratio will be prioritized and those who offer a lower one are in risk of not being even considered by the miners. This means that transferring 1 coin costs almost the same as transferring 1.000.000 of them.\u003c/p\u003e\n\u003ch4 id=\"double-spending\"\u003eDouble spending\u003c/h4\u003e\n\u003cp\u003eOne of the main concerns of past implementations of electronic payments was \u003cstrong\u003edouble-spending\u003c/strong\u003e, which is solved in Bitcoin by recording and agreeing a single public history of the transactions in the order they were received, considering the earliest as the valid one.\u003c/p\u003e\n\u003ch3 id=\"price\"\u003ePrice\u003c/h3\u003e\n\u003cp\u003eThe price of Bitcoin, like any economic asset, fluctuates based on \u003cstrong\u003esupply and demand\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIn Bitcoin, \u003cstrong\u003ethe supply is fixed\u003c/strong\u003e to 21 million units, making it scarce and predictable by definition, as well as eliminating monetary inflation after the date set. This is why the term \u003cstrong\u003edigital gold\u003c/strong\u003e is often used.\u003c/p\u003e\n\u003cp\u003eIn spite of this comparison, note that the amount of available gold is, even though barely increasing, still unknown and more could be found on earth or space.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/bitcoin_time_vs_inflation.png\" alt=\"Bitcoin inflation vs time\"\u003e\u003c/p\u003e\n\u003cp\u003eUnlike fiat currencies, Bitcoin units are not created out of thin air, but require miners to spend \u003cstrong\u003escarce resources\u003c/strong\u003e like time and electricity for it.\u003c/p\u003e\n\u003cp\u003eFurthemore, many of the coins fall out of circulation due to the owners losing access to their private key and thus to the coins, reducing the available supply even more.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI will be writing an article about money, if Bitcoin can be considered money and comparing it with fiat and commodity currencies.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"volatility\"\u003eVolatility\u003c/h3\u003e\n\u003cp\u003eBitcoin is well-known for being volatile, one of the core reasons for this is that it\u0026rsquo;s an \u003cstrong\u003eemerging\u003c/strong\u003e and \u003cstrong\u003eimmature\u003c/strong\u003e market.\u003c/p\u003e\n\u003cp\u003eThe introduction of a new technology that attempts to replace traditional institutions generates a lot of uncertainity and speculation, which derives in the variation of the consumers\u0026rsquo; appreciation about the value of it.\u003c/p\u003e\n\u003cp\u003eIf all the prices in the economy were removed, we would be in a similar situation where people would offer significantly different amounts of money for the same product.\u003c/p\u003e\n\u003cp\u003eWe can expect the price to stabilize as Bitcoin adoption increases and more liquidity enters the market.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/price.png\" alt=\"Price\"\u003e\u003c/p\u003e\n\u003ch2 id=\"fundamental-principles\"\u003eFundamental principles\u003c/h2\u003e\n\u003ch3 id=\"decentralization\"\u003eDecentralization\u003c/h3\u003e\n\u003cp\u003eBitcoin has opened up the possibility of exchanging assets in a secure and reliable way with no central authority being capable of controlling the transactions nor the system in which they are executed.\u003c/p\u003e\n\u003cp\u003eThis is, decentralization \u003cstrong\u003eeliminates the single point of failure of a system\u003c/strong\u003e as there\u0026rsquo;s no authority whose decisions could impact its functionality.\u003c/p\u003e\n\u003cp\u003eAt the same time, it makes the system virtually impossible to stop or shut down. Each node has a copy of the database and as long as they can communicate between each other it will keep working.\u003c/p\u003e\n\u003cp\u003eHowever, it\u0026rsquo;s not an intrinsic characteristic of cryptocurrencies, in fact, centralized ones controlled by a state, bank, company or institution exist.\u003c/p\u003e\n\u003ch3 id=\"anonymity-and-pseudonymity\"\u003eAnonymity and pseudonymity\u003c/h3\u003e\n\u003cp\u003eBlockchains were originally designed to be pseudonymous - they use hashes to identify users instead of personal information -, but when users interact with them anonymity becomes really tricky.\u003c/p\u003e\n\u003cp\u003eCentralized exchanges and applications that offer an interface to operate with the blockchain or companies that accept cryptos as a form of payment \u003cstrong\u003emust verify the identity of their users\u003c/strong\u003e, otherwise they wouldn\u0026rsquo;t be able to recognise who is sending/receiving currencies.\u003c/p\u003e\n\u003cp\u003eDepending on their location they could also be under Know-your-customer (KYC) and anti-money-laundering (AML) regulations, being required to provide sensitive information to the authorities in order to operate.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDecentralized exchanges, however, tend to be more private as they only operate with information inside the blockchain and under less regulations as they are not in control of the funds.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eFuthermore, every single transaction remains in the immutable ledger \u003cstrong\u003eforever\u003c/strong\u003e. If your account\u0026rsquo;s public key is associated with your identity, \u003cstrong\u003eabsolutely all\u003c/strong\u003e the transactions you have made in the past are now exposed, as well as the public key addresses of the parties that interacted with you - whose identities can be linked as well.\u003c/p\u003e\n\u003ch3 id=\"transparency\"\u003eTransparency\u003c/h3\u003e\n\u003cp\u003eInstead of trusting a central authority, \u003cstrong\u003eBitcoin puts trust in code\u003c/strong\u003e (cryptographic proofs), which in most cases is \u003cstrong\u003epublic and free to copy and modify\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eIt\u0026rsquo;s important to note that Bitcoin is not a single software project but a protocol that may be implemented by any number of clients which are in turn developed and maintained by a group of developers that have permissions to commit to the project.\u003c/p\u003e\n\u003cp\u003eIn many cases, potential changes in the codebase are \u003cstrong\u003edeeply discussed and reviewed\u003c/strong\u003e by the community members before implemented, however, this might not be done in all of the projects. Bitcoin clients that do not comply with the consensus rules will have their transactions and blocks rejected by the other compliant clients.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhen two groups differ radically in the scope of the project a \u003ca href=\"https://www.investopedia.com/terms/h/hard-fork.asp\"\u003ehard fork\u003c/a\u003e can be produced, where one group stays with the current state and the other copies and modifies it to meet their needs. In these cases, the new version gives each of the nodes the same amount of coins that had in the old version.\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/images/bitcoin_source_code.jpg\" alt=\"Bitcoin Core source code\" title=\"Bitcoin Core source code\"\u003e\u003c/p\u003e\n\u003cp\u003eOpen-source means the code is open to the public and that \u003cstrong\u003eanyone\u003c/strong\u003e can read the codebase of the project and \u003cstrong\u003everify\u003c/strong\u003e that what is being promoted is actually how it works.\u003c/p\u003e\n\u003cp\u003eI implemented a simplified version of Bitcoin which contains most of its core features and allows the user to run a simulated peer-to-peer network with several nodes communicating between them. The project is called \u003ca href=\"https://www.github.com/GGP1/btcs\"\u003ebtcs\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"conclusion\"\u003eConclusion\u003c/h1\u003e\n\u003cp\u003eCryptography, economics and computer science have been combined for the creation of a digital system that aims to improve the way in which multiple parties interact.\u003c/p\u003e\n\u003cp\u003eAgreements that previously required to trust an intermediary to supervise them now can be executed in a predictable way by a publicly accessible algorithm.\u003c/p\u003e\n\u003cp\u003eBitcoin merely represents value and works as a medium of exchange inside those systems.\u003c/p\u003e\n\u003cp\u003eIt\u0026rsquo;s uncertain if this project will be the one used to make daily transactions in the future, but they are clearly a big step towards the decentralization and digitalization of human\u0026rsquo;s communications.\u003c/p\u003e\n\u003cdiv class=\"footnotes\" role=\"doc-endnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn:1\"\u003e\n\u003cp\u003ePeer-to-peer refers to an operation done by members of the same network without relying on a dedicated central server.\u0026#160;\u003ca href=\"#fnref:1\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:2\"\u003e\n\u003cp\u003eCryptography is a process that ensures the confidentiality and integrity of some data by converting it in an unintelligible form. Its goal is the data to be readable and processable by only those for whom it is intended.\u0026#160;\u003ca href=\"#fnref:2\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:3\"\u003e\n\u003cp\u003eA hash is a mathematical one-way function that converts an input of arbitrary length into an encrypted output of a fixed length. Using this function on the same data will return the same result, allowing users to verify the information integrity. One-way means it cannot be reverse-engineered, given an output we cannot discover the input.\u0026#160;\u003ca href=\"#fnref:3\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:4\"\u003e\n\u003cp\u003eThe proof of work mechanism was introduced by \u003cstrong\u003eAdam Back\u003c/strong\u003e in 1997 and originally used in \u003ca href=\"https://en.wikipedia.org/wiki/Hashcash\"\u003eHashcash\u003c/a\u003e to limit email spam and denial-of-service attacks.\u0026#160;\u003ca href=\"#fnref:4\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:5\"\u003e\n\u003cp\u003eThe target hash is the maximum allowed value that a successful hash can be, it is determined by the difficulty.\u0026#160;\u003ca href=\"#fnref:5\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"fn:6\"\u003e\n\u003cp\u003eNick Szabo\u0026rsquo;s definition: Social scalability is the ability of an institution  a relationship or shared endeavor, in which multiple people repeatedly participate, and featuring customs, rules, or other features which constrain or motivate participants\u0026rsquo; behaviors - to overcome shortcomings in human minds and in the motivating or constraining aspects of said institution that limit who or how many can successfully participate.\u0026#160;\u003ca href=\"#fnref:6\" class=\"footnote-backref\" role=\"doc-backlink\"\u003e\u0026#x21a9;\u0026#xfe0e;\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e\n","description":"The new monetary standard","image":"/images/new_money.jpg","permalink":"https://ggp1.github.io/posts/new_monetary_standard/","title":"The new monetary standard"}]